import{r as m,j as e,u as I,R as W,C as S,L as G}from"./index-B4y5XhIU.js";import{L as P}from"./LinkBtn-IK4A_IMo.js";import{a as $,s as D}from"./form.module-BVm9ITXb.js";const B="_main_3lff2_1",E="_roomInfo_3lff2_9",T="_userList_3lff2_25",F="_context_3lff2_45",O="_chat_3lff2_53",H="_form_3lff2_73",J="_messageList_3lff2_147",V="_messagePlaceholder_3lff2_173",A="_message_3lff2_147",q="_vs_3lff2_219",h={main:B,roomInfo:E,userList:T,context:F,chat:O,form:H,messageList:J,messagePlaceholder:V,message:A,vs:q};var x=(s=>(s.preparing="preparing",s.starting="starting",s.started="started",s.ended="ended",s))(x||{}),b=(s=>(s.xo="xo",s.stonePapper="stonePapper",s.null="",s))(b||{}),g=(s=>(s.connected="connected",s.disconnected="disconnected",s.message="message",s.roomChange="roomChange",s.xo="xo",s.stonePapper="stonePapper",s))(g||{});function U(s){const[r,n]=m.useState("");function i(){return s.messageList.length<1?e.jsx("li",{className:h.messagePlaceholder,children:e.jsx("p",{className:"main-context",children:" no messages"})}):s.messageList.map(t=>t.body==="connected"||t.body==="disconnected"?e.jsx("li",{className:h.message,children:e.jsxs("p",{className:"main-context",children:[e.jsx("span",{className:"green",children:t.sender})," is ",e.jsx("span",{className:`${t.body==="connected"?"green":"red"}`,children:t.body}),t.time]})},t.sender+t.time):t.sender==="system"?e.jsx("li",{className:h.message,children:e.jsxs("p",{className:"main-context",children:[t.sender,": ",t.body]})},t.sender+t.time):e.jsxs("li",{className:h.message,children:[e.jsx("h4",{children:t.sender}),e.jsx("p",{className:"main-context",children:t.time}),e.jsx("p",{children:t.body})]},t.sender+t.time))}function o(t){var p;t.code==="Enter"&&((p=t.target.form)==null||p.requestSubmit())}function f(t){t.preventDefault(),s.sendMessage(r),n("")}return e.jsxs("div",{className:h.chat,children:[e.jsx("p",{className:"main-context",children:"chat"}),e.jsx("ul",{className:h.messageList,children:i()}),e.jsxs("form",{onSubmit:f,className:h.form,children:[e.jsx("textarea",{onKeyDown:o,onInput:t=>{n(t.target.value)},value:r,name:"body",placeholder:"send message"}),e.jsx("button",{type:"submit",disabled:r.length<1,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"red",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",width:"50",height:"50",viewBox:"0 0 256 256",xmlSpace:"preserve",children:[e.jsx("defs",{}),e.jsxs("g",{style:{stroke:"none",strokeWidth:0,strokeDasharray:"none",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:10,fillRule:"nonzero",opacity:1},transform:"translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)",children:[e.jsx("path",{d:"M 89.981 6.2 C 90 6.057 90.001 5.915 89.979 5.775 c -0.003 -0.021 -0.001 -0.041 -0.005 -0.062 c -0.033 -0.163 -0.098 -0.317 -0.183 -0.462 c -0.009 -0.016 -0.01 -0.033 -0.019 -0.049 c -0.015 -0.024 -0.039 -0.036 -0.055 -0.059 c -0.034 -0.048 -0.06 -0.102 -0.101 -0.146 c -0.051 -0.056 -0.113 -0.097 -0.17 -0.144 c -0.031 -0.025 -0.058 -0.054 -0.09 -0.076 c -0.134 -0.093 -0.28 -0.164 -0.436 -0.209 c -0.028 -0.008 -0.056 -0.009 -0.084 -0.015 c -0.132 -0.03 -0.267 -0.041 -0.404 -0.034 c -0.046 0.002 -0.089 0.006 -0.135 0.012 c -0.039 0.006 -0.079 0.002 -0.118 0.01 l -87 19.456 c -0.611 0.137 -1.073 0.639 -1.159 1.259 c -0.085 0.62 0.224 1.229 0.775 1.525 l 23.523 12.661 l 7.327 23.36 c 0.008 0.025 0.025 0.043 0.034 0.067 c 0.021 0.056 0.052 0.106 0.08 0.16 c 0.059 0.114 0.127 0.218 0.211 0.312 c 0.022 0.025 0.03 0.057 0.054 0.08 c 0.022 0.021 0.05 0.028 0.073 0.048 c 0.099 0.086 0.207 0.155 0.325 0.213 c 0.047 0.023 0.088 0.053 0.136 0.07 c 0.164 0.061 0.336 0.1 0.517 0.1 c 0.011 0 0.022 0 0.033 0 c 0.179 -0.004 0.349 -0.044 0.509 -0.107 c 0.041 -0.016 0.075 -0.044 0.114 -0.063 c 0.127 -0.063 0.244 -0.139 0.349 -0.235 c 0.02 -0.018 0.046 -0.024 0.065 -0.044 l 12.009 -12.209 l 23.18 12.477 c 0.221 0.119 0.466 0.18 0.711 0.18 c 0.188 0 0.378 -0.035 0.557 -0.107 c 0.412 -0.164 0.73 -0.504 0.869 -0.926 L 89.93 6.473 c 0.014 -0.044 0.015 -0.09 0.025 -0.135 C 89.966 6.292 89.975 6.247 89.981 6.2 z M 77.435 10.018 L 25.58 36.717 L 5.758 26.047 L 77.435 10.018 z M 74.32 14.997 L 36.813 43.768 c -0.003 0.002 -0.005 0.006 -0.007 0.008 c -0.112 0.087 -0.209 0.194 -0.294 0.314 c -0.018 0.025 -0.035 0.05 -0.051 0.076 c -0.017 0.028 -0.039 0.052 -0.055 0.081 c -0.054 0.1 -0.093 0.204 -0.122 0.309 c -0.001 0.005 -0.005 0.009 -0.006 0.014 L 32.96 56.977 l -5.586 -17.809 L 74.32 14.997 z M 35.992 57.249 l 2.693 -10.072 l 4.717 2.539 L 35.992 57.249 z M 69.177 60.184 L 40.479 44.737 l 45.09 -34.588 L 69.177 60.184 z",style:{stroke:"none",strokeWidth:1,strokeDasharray:"none",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:10,fillRule:"nonzero",opacity:1},transform:" matrix(1 0 0 1 0 0) ",strokeLinecap:"round"}),e.jsx("path",{d:"M 12.9 85.482 c -0.38 0 -0.76 -0.144 -1.052 -0.431 c -0.591 -0.581 -0.599 -1.53 -0.018 -2.121 l 14.292 -14.528 c 0.581 -0.592 1.531 -0.598 2.121 -0.018 c 0.591 0.581 0.599 1.53 0.018 2.121 L 13.97 85.034 C 13.676 85.333 13.288 85.482 12.9 85.482 z",style:{stroke:"none",strokeWidth:1,strokeDasharray:"none",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:10,fillRule:"nonzero",opacity:1},transform:" matrix(1 0 0 1 0 0) ",strokeLinecap:"round"}),e.jsx("path",{d:"M 36.431 79.593 c -0.38 0 -0.76 -0.144 -1.052 -0.431 c -0.591 -0.581 -0.599 -1.53 -0.018 -2.121 l 14.291 -14.527 c 0.582 -0.591 1.531 -0.598 2.121 -0.018 c 0.591 0.581 0.599 1.53 0.018 2.121 L 37.501 79.145 C 37.207 79.443 36.819 79.593 36.431 79.593 z",style:{stroke:"none",strokeWidth:1,strokeDasharray:"none",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:10,fillRule:"nonzero",opacity:1},transform:" matrix(1 0 0 1 0 0) ",strokeLinecap:"round"}),e.jsx("path",{d:"M 8.435 67.229 c -0.38 0 -0.76 -0.144 -1.052 -0.431 c -0.591 -0.581 -0.599 -1.53 -0.018 -2.121 l 10.445 -10.618 c 0.581 -0.591 1.531 -0.598 2.121 -0.018 c 0.591 0.581 0.599 1.53 0.018 2.121 L 9.505 66.78 C 9.211 67.079 8.823 67.229 8.435 67.229 z",style:{stroke:"none",strokeWidth:1,strokeDasharray:"none",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:10,fillRule:"nonzero",opacity:1},transform:" matrix(1 0 0 1 0 0) ",strokeLinecap:"round"})]})]})})]})]})}function y(){const s=new Date;return`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`}function K(s){const r=I(),n=m.useRef(),[i,o]=m.useState([]),[f,t]=m.useState(),[p,k]=m.useState(!1),v=m.useRef(!1),N=m.useRef(!1);async function j(){try{n.current=await $.connectToWs(Number(window.location.search.split("?roomPort=")[1]),s.id,s.name),n.current.onopen=()=>{l(g.connected,{message:"null"}),console.log("Connected to WebSocket on port:: "+Number(window.location.search.split("?roomPort=")[1]))},n.current.onmessage=a=>{const{actionType:d,payload:c,message:L=""}=JSON.parse(a.data);switch(d){case g.message:o(u=>[c,...u]);break;case g.connected:t(c.session),N.current=c.session.creator===s.name,o(u=>[{body:"connected",sender:c.user,time:y()},...u]);break;case g.disconnected:t(c.session),o(u=>[{body:"disconnected",sender:c.user,time:y()},...u]);break;case g.roomChange:t(c.session),L&&o(u=>[{body:L,sender:"system",time:y()},...u]),c.session.game.status===x.started&&(v.current=c.session.game.currentPlayers.some(u=>u.name===s.name),k(!0));break;case g.xo:t(c.session),o(u=>[{body:"room settings change",sender:"system",time:y()},...u]);break;default:break}},n.current.onclose=()=>{}}catch(a){o(d=>[{body:JSON.stringify(a),sender:"system",time:y()},...d]),console.log(a)}}function C(a){l(g.message,{body:a,sender:s.name,time:y()})}function _(){r("/")}function M(){var a;l(g.disconnected,{userName:s.name}),(a=n.current)==null||a.close(1e3,JSON.stringify({userName:s.name}))}function R(a){l(g.roomChange,a)}function z(a,d){k(!1),l(g.stonePapper,{name:a,value:d})}function l(a,d){var c;(c=n.current)==null||c.send(JSON.stringify({actionType:a,payload:d}))}return{messageList:i,roomData:f,isCreator:N,isPLayer:v,isPlayerTurn:p,gameTurn:z,leaveLobby:_,disconnectWs:M,connectWs:j,sendMessage:C,changeRoomData:R}}function X(s){const r=m.useRef(null),n=m.useRef(null);function i(o){o.preventDefault(),s.createGame({game:{status:x.starting,name:n.current.value,currentPlayers:[{name:"",value:""},{name:"",value:""}],winner:""}})}return e.jsx("div",{children:e.jsxs("div",{className:"main-container",children:[e.jsx("p",{className:"main-context",children:"create a game"}),e.jsxs("form",{className:D.form,onSubmit:i,children:[e.jsxs("label",{children:["chois game:",e.jsx("select",{required:!0,ref:n,children:e.jsx("option",{value:b.stonePapper,children:"stonePapper"})})]}),e.jsxs("label",{children:["count of players:",e.jsx("input",{ref:r,type:"number",value:2,max:9,disabled:!0,className:D.inputNum})]}),e.jsx(P,{action:()=>{console.log("createGame")},type:"submit",children:" create game"})]})]})})}function Y(s){const{userData:r}=W.useContext(S);function n(i){console.log(i),s.callback(i,s.index)}return e.jsx(e.Fragment,{children:s.userName?e.jsx("button",{disabled:s.userName!==r.name,onClick:()=>n(""),id:`player_${s.index}`,children:s.userName}):e.jsx("button",{onClick:()=>n(r.name),id:`player_${s.index}`,children:"+"})})}function Q(s){function r(){return s.currentPlayers.map((n,i)=>e.jsx(Y,{callback:s.changePlayer,userName:n.name,index:i},`player_${n.name}_${i}`))}return e.jsxs("div",{className:"main-container",children:[e.jsx("p",{className:"main-context",children:"add players"}),e.jsxs("div",{className:h.vs,children:[r(),e.jsx("p",{className:"main-context",children:"vs"})]}),s.isCreator&&e.jsx(P,{action:()=>s.startGame("startGame"),dissabled:s.currentPlayers.some(n=>n.name===""),children:"startGame"})]})}const Z="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20height='50px'%20width='50px'%20version='1.1'%20id='_x34_'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20512%20512'%20xml:space='preserve'%3e%3cg%3e%3cg%3e%3cpath%20style='fill:%23B2B1B1;'%20d='M423.9,35.44c-0.398,7.566-2.628,15.929-6.61,25.088l-88.403,182.461l-10.115,20.867%20c0,0-13.539,1.513-30.264,8.84c-10.433,4.46-22.141,11.229-32.494,21.185c-5.256,5.017-10.194,10.991-14.415,17.84%20c-1.991,3.345-3.902,6.292-5.734,9.159l-29.468-23.574c2.469-2.867,4.699-5.893,6.531-8.76l10.592-15.849l32.494-48.821%20l21.504-32.255l55.511-83.306L405.184,0C418.484,8.84,424.696,20.627,423.9,35.44z'/%3e%3c/g%3e%3cg%3e%3cpath%20style='fill:%23AFAFAF;'%20d='M305.63,297.305l-29.467,23.574c-1.832-2.867-3.743-5.814-5.734-9.159%20c-4.221-6.849-9.159-12.822-14.415-17.84c-10.353-9.955-22.061-16.725-32.494-21.185c-16.725-7.327-30.264-8.84-30.264-8.84%20l-5.176-10.593L94.737,60.528c-9.318-21.185-8.92-37.91,1.115-50.573c2.867-3.664,6.531-7.009,10.991-9.955l41.812,62.758%20l91.907,138.02l15.451,23.097l32.494,48.821l10.593,15.849C300.932,291.412,303.161,294.438,305.63,297.305z'/%3e%3c/g%3e%3cpath%20style='fill:%23DC6D41;'%20d='M212.05,356.161c10.991-16.486,17.123-25.087,23.813-35.282l-29.468-23.574%20c-8.442,9.876-20.468,18.397-38.467,14.097c-10.274-4.221-21.105-6.292-31.777-6.212c-5.097,0.079-10.194,0.637-15.132,1.592%20c-20.309,4.062-39.184,15.928-51.528,34.485l-29.866,44.919c-5.735,8.522-9.557,17.761-11.628,27.158%20c-2.549,11.15-2.628,22.619-0.398,33.609c0.16,0.877,0.398,1.752,0.637,2.629c4.46,19.273,16.087,37.033,33.848,48.82%20c8.283,5.496,17.203,9.32,26.362,11.389c11.389,2.707,23.176,2.867,34.406,0.637c20.229-4.062,39.104-15.929,51.449-34.485%20l29.946-44.919c12.344-18.556,16.088-40.538,11.946-60.767C215.236,365.479,213.882,360.781,212.05,356.161z%20M172.707,410%20l-29.945,44.917c-6.61,9.955-16.486,16.168-27.317,18.398c-10.911,2.15-22.38,0.159-32.335-6.452%20c-9.955-6.61-16.167-16.486-18.397-27.317c-2.15-10.911-0.239-22.38,6.451-32.335l29.866-44.918%20c6.69-9.955,16.566-16.168,27.397-18.318c10.832-2.15,22.38-0.239,32.335,6.371c9.955,6.611,16.088,16.486,18.318,27.397%20C181.229,388.576,179.317,400.125,172.707,410z'/%3e%3cpath%20style='fill:%23DC6D41;'%20d='M472.959,387.063c-0.159-0.318-0.398-0.558-0.557-0.876l-29.866-44.919%20c-11.946-17.919-29.945-29.627-49.378-34.008c-0.637-0.159-1.354-0.318-2.071-0.478c-15.451-3.106-31.857-1.672-46.989,4.619%20c-17.999,4.301-30.025-4.221-38.467-14.097l-29.467,23.574c6.61,10.194,12.822,18.796,23.813,35.282%20c-1.832,4.619-3.186,9.318-4.142,14.097c-4.142,20.229-0.398,42.211,11.946,60.767l29.946,44.919%20c12.345,18.556,31.22,30.423,51.449,34.485c20.229,4.062,42.211,0.319,60.767-12.026c18.556-12.344,30.423-31.219,34.485-51.449%20C488.41,427.043,484.906,405.46,472.959,387.063z%20M447.315,439.547c-2.23,10.831-8.442,20.707-18.397,27.317%20c-9.955,6.611-21.424,8.602-32.335,6.452c-10.832-2.23-20.707-8.443-27.317-18.398L339.319,410%20c-6.61-9.876-8.522-21.424-6.371-32.256c2.23-10.911,8.362-20.787,18.318-27.397c9.955-6.611,21.504-8.522,32.335-6.371%20c10.831,2.15,20.707,8.362,27.397,18.318l29.866,44.918C447.553,417.167,449.465,428.636,447.315,439.547z'/%3e%3ccircle%20style='fill:%238A8B8A;'%20cx='255.388'%20cy='259.89'%20r='11.482'/%3e%3c/g%3e%3c/svg%3e",ee="/tg-games/assets/stone-o9hOD-N5.svg",se="/tg-games/assets/paper-EGAV62kH.svg",ne="_main_1fdnk_1",te="_btn_1fdnk_17",w={main:ne,btn:te};function ae(s){const{userData:r}=m.useContext(S);return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"main-context",children:"make ur choice"}),e.jsxs("div",{className:w.main,children:[e.jsxs("button",{className:w.btn,onClick:()=>{s.callback(r.name,"scissors")},children:[e.jsx("img",{src:Z,alt:"scissors"}),"scissors"]}),e.jsxs("button",{className:w.btn,onClick:()=>{s.callback(r.name,"stone")},children:[e.jsx("img",{src:ee,alt:"scissors"}),"stone"]}),e.jsxs("button",{className:w.btn,onClick:()=>{s.callback(r.name,"papper")},children:[e.jsx("img",{src:se,alt:"scissors"}),"papper"]})]})]})}function re(s){return e.jsxs("div",{className:"main-container",children:[e.jsxs("p",{className:"main-context",children:["game is started: ",b.stonePapper]}),s.gameData.name===b.stonePapper?e.jsx(ae,{callback:s.stonePapperCallback}):""]})}function ce(s){return e.jsxs("div",{className:"main-container",children:[s.game.winner,s.isHost&&e.jsx(P,{action:s.startNewgame,children:" create new game"})]})}function ie(){return e.jsxs("div",{className:"main-container",children:[e.jsx("h3",{children:"waiting for another player"}),e.jsx(G,{})]})}function de(){const{userData:s}=W.useContext(S),{messageList:r,roomData:n,isCreator:i,isPLayer:o,isPlayerTurn:f,gameTurn:t,leaveLobby:p,disconnectWs:k,connectWs:v,sendMessage:N,changeRoomData:j}=K(s);m.useEffect(()=>(v(),()=>{k()}),[]),m.useEffect(()=>{console.log(n)},[n]);function C(l,a){if(!n)return;const d={...n.game},c=d.currentPlayers.findIndex(L=>L.name===l);c>=0&&(d.currentPlayers[c].name=""),d.currentPlayers[a].name=l,j({game:d})}function _(){(n==null?void 0:n.game.currentPlayers.length)<2||!n||j({game:{status:x.started,currentPlayers:n==null?void 0:n.game.currentPlayers,name:n==null?void 0:n.game.name,winner:""}})}function M(l,a){t(l,a)}function R(){j({game:{status:x.preparing,currentPlayers:[{name:"",value:""},{name:"",value:""}],name:b.null,winner:""}})}function z(){return n?s.name===n.creator&&n.game.status===x.preparing?e.jsx(X,{createGame:j}):n.game.status===x.starting?e.jsx(Q,{isCreator:i.current,startGame:_,changePlayer:C,currentPlayers:n.game.currentPlayers}):n.game.status===x.started&&o.current&&f?e.jsx(re,{stonePapperCallback:M,gameData:n.game}):n.game.status===x.started&&!o.current||n.game.status===x.started&&!f?e.jsx(ie,{}):n.game.status===x.ended?e.jsx(ce,{isHost:i.current,startNewgame:R,game:n.game}):e.jsx("div",{className:"main-container",children:e.jsx("p",{className:"main-context",children:"waiting for host"})}):e.jsx("div",{children:"loading"})}return e.jsx("div",{children:n?e.jsxs("div",{className:h.main,children:[e.jsx(P,{action:()=>{p()},children:"leave lobby"}),e.jsxs("div",{className:"main-container",children:[e.jsx("p",{className:"main-context",children:" lobby info"}),e.jsx("h2",{children:n.roomName}),e.jsxs("p",{children:["players: ",n.usersInRoom.length]}),e.jsx("ul",{className:h.userList,children:n.usersInRoom.map(l=>e.jsx("li",{children:l.name},`userList-${l.id}`))})]}),e.jsx(m.Suspense,{fallback:e.jsx(G,{}),children:z()}),e.jsx(U,{messageList:r,sendMessage:N})]}):e.jsx("div",{children:"loading"})})}export{de as default};
