import{r as m,u as x,j as t,P as f,R as j,C as p}from"./index-DLTxB3Sf.js";import{a as d,s as g}from"./form.module-BVm9ITXb.js";import{L as l}from"./LinkBtn-Cb2yhsMU.js";function h(){const[e,r]=m.useState({status:0,message:"init"}),s=x();function n(){r({status:102,message:"loading..."})}function i(o){r(o)}async function a(o){try{n();const c=await d.createRoom(o);s(`/lobby?roomPort=${c.port}`)}catch(c){console.log(c),i(c)}}async function u(){try{n();const o=await d.getRooms();if(o.length>0)r({status:200,message:"ok"});else throw new Error("no rooms");return o}catch(o){return console.log(o),i(o),[]}}return{apiStatus:e,createRoom:a,getRooms:u}}const R="_roomList_jhiih_3",y={roomList:R};function b(e){function r(){return e.itemList.length<1?t.jsx("li",{children:t.jsx("p",{children:"no rooms"})}):e.itemList.map(s=>t.jsxs("li",{children:[t.jsxs("div",{children:[t.jsx("h3",{children:s.roomName}),t.jsxs("p",{children:["players: ",s.usersInRoom.length]})]}),t.jsx(l,{action:`/lobby?roomPort=${s.port}`,children:"connect"})]},s.creator+s.roomName))}return t.jsx("div",{children:t.jsx("ul",{className:y.roomList,children:r()})})}function L(){const{getRooms:e,apiStatus:r}=h(),[s,n]=m.useState([]);m.useEffect(()=>{i()},[]);async function i(){try{const a=await e();n(a)}catch(a){console.log(a)}}return t.jsx(t.Fragment,{children:r.status===102?t.jsx(f,{}):t.jsx(b,{itemList:s})})}function v(){const{userData:e}=j.useContext(p),{apiStatus:r,createRoom:s}=h(),n=m.useRef(null);function i(a){var o;a.preventDefault();const u={creator:e.name,roomName:(o=n.current)==null?void 0:o.value,usersInRoom:[]};s(u)}return t.jsx("div",{children:t.jsxs("form",{onSubmit:i,className:g.form,children:[t.jsxs("label",{children:["choice room name:",t.jsx("input",{ref:n,type:"text",required:!0,minLength:2,defaultValue:`${e.name}'s lobby`})]}),t.jsx(l,{action:()=>{},type:"submit",dissabled:r.status===102,children:" create room"})]})})}function P(){return t.jsxs("div",{children:[t.jsx("nav",{className:"main-nav",children:t.jsx(l,{action:"/",children:" go to main page"})}),window.location.search.split("?find=")[1]==="true"?t.jsx(L,{}):t.jsx(v,{})]})}export{P as default};
